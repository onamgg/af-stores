<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AF Stores</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
  background: linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0.5)),
              url('https://images.unsplash.com/photo-1582582494703-9d1146b9c7b1');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  transition: 0.4s;
}

h1 {
  background: #222;
  color: white;
  padding: 15px;
  margin: 0;
}

#categories button {
  padding: 10px 20px;
  margin: 10px;
  font-size: 16px;
  cursor: pointer;
}

#products {
  display: none;
  margin-top: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.product {
  border: 1px solid #ccc;
  margin: 15px;
  padding: 10px;
  width: 220px;
  background: rgba(255,255,255,0.95);
  border-radius: 8px;
  display: inline-block;
}

.product img {
  width: 100%;
  height: 130px;
  object-fit: cover;
}

#cartButton {
  position: fixed;
  top: 15px;
  right: 15px;
  background: green;
  color: white;
  padding: 10px 15px;
  cursor: pointer;
  border-radius: 5px;
  z-index: 1000;
}

#cart {
  position: fixed;
  right: -320px;
  top: 0;
  width: 300px;
  height: 100%;
  background: #f4f4f4;
  border-left: 2px solid #ccc;
  padding: 10px;
  overflow-y: auto;
  transition: 0.3s;
}

#cart.show {
  right: 0;
}

#cart li button {
  margin-left: 10px;
  background: crimson;
  color: white;
  border: none;
  padding: 3px 6px;
  border-radius: 4px;
  cursor: pointer;
}

.checkout-btn {
  background: green;
  color: white;
  padding: 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>AF Stores</h1>

<div id="cartButton" onclick="toggleCart()">ðŸ›’ Cart</div>

<div id="categories">
  <button onclick="showCategory('vegetable')">Vegetables</button>
  <button onclick="showCategory('stationary')">Stationary</button>
  <button onclick="showCategory('bakery')">Bakery</button>
</div>

<div id="products"></div>

<div id="cart">
  <h2>Your Cart</h2>
  <ul id="cartList"></ul>
  <p id="total">Total: â‚¹0</p>
  <button onclick="checkout()" class="checkout-btn">Checkout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, addDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDUeKvzHtL3wfad44uYZy4BauoBKLl75Xc",
  authDomain: "af-stores.firebaseapp.com",
  projectId: "af-stores",
  storageBucket: "af-stores.firebasestorage.app",
  messagingSenderId: "812053057314",
  appId: "1:812053057314:web:6eac81748c9dae4018df7b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let cart = [];
let currentProducts = [];

// One-time upload to Firebase for initial products
async function uploadProducts(products) {
  const existingProducts = await getDocs(collection(db, "products"));
  const existingNames = existingProducts.docs.map(d => d.data().name);

  for (const product of products) {
    if (!existingNames.includes(product.name)) {
      await addDoc(collection(db, "products"), product);
    }
  }
  console.log("Products uploaded âœ…");
}

// Manually add products you want to appear
uploadProducts([
  {"name":"Potato","category":"vegetable","price":20,"stock":50,"image":"https://images.unsplash.com/photo-1582515073490-dc8e2c5b8c42"},
  {"name":"Tomato","category":"vegetable","price":30,"stock":40,"image":"https://images.unsplash.com/photo-1567306226416-28f0efdc88ce"},
  {"name":"Notebook","category":"stationary","price":60,"stock":80,"image":"https://images.unsplash.com/photo-1519681393784-d120267933ba"}
]);

// Show category
window.showCategory = async function(category){
  const productsDiv = document.getElementById("products");
  productsDiv.innerHTML = "";
  productsDiv.style.display = "block";

  const querySnapshot = await getDocs(collection(db, "products"));
  currentProducts = [];

  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    if(data.category === category){
      currentProducts.push({ id: docSnap.id, ...data });
    }
  });

  currentProducts.forEach((item, index) => {
    productsDiv.innerHTML += `
      <div class="product">
        <img src="${item.image}">
        <h3>${item.name}</h3>
        <p>Price: â‚¹${item.price}</p>
        <p>Stock: ${item.stock}</p>
        <button onclick="addToCart(${index})">Add to Cart</button>
      </div>`;
  });
};

// Add to cart and reduce stock globally
window.addToCart = async function(index){
  const item = currentProducts[index];
  if(item.stock <= 0){
    alert("Out of Stock");
    return;
  }

  const productRef = doc(db, "products", item.id);
  await updateDoc(productRef, { stock: item.stock - 1 });

  cart.push(item);
  updateCart();
  showCategory(item.category);
};

// Update cart UI
function updateCart(){
  const cartList = document.getElementById("cartList");
  const total = document.getElementById("total");
  cartList.innerHTML = "";
  let sum = 0;

  cart.forEach(item => {
    sum += item.price;
    cartList.innerHTML += `<li>${item.name} - â‚¹${item.price}</li>`;
  });

  total.innerText = "Total: â‚¹" + sum;
}

// Cart toggle
window.toggleCart = function(){
  document.getElementById("cart").classList.toggle("show");
};

// Checkout
window.checkout = function(){
  if(cart.length === 0){
    alert("Your cart is empty!");
    return;
  }

  cart = [];
  updateCart();
  window.location.href = "thankyou.html";
};
</script>
</body>
</html>
