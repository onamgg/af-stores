<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AF Stores</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; margin: 0; padding: 0; }
    header { background: #007bff; color: white; text-align: center; padding: 20px 0; font-size: 2rem; }
    main { display: flex; flex-wrap: wrap; justify-content: center; padding: 20px; gap: 20px; }
    .product-card { background: white; padding: 15px; border-radius: 10px; width: 200px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; }
    .product-card h3 { margin: 10px 0 5px; text-align: center; }
    .product-card p { margin: 5px 0; }
    .product-card button { margin-top: 10px; padding: 5px 10px; border: none; border-radius: 5px; background: #28a745; color: white; cursor: pointer; }
    .product-card button:disabled { background: #ccc; cursor: not-allowed; }
    #cart { background: #fff; padding: 20px; margin: 20px auto; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    #cart h2 { margin-top: 0; }
    #cart ul { list-style: none; padding: 0; }
    #cart li { margin: 5px 0; }
    #cart p { font-weight: bold; }
  </style>
</head>
<body>

<header>AF Stores</header>

<main id="productList"></main>

<div id="cart">
  <h2>Your Cart</h2>
  <ul id="cartList"></ul>
  <p id="total">Total: ₹0</p>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA2aDktsW6eAVuT9M-1ZfALjlhUO6IWBCk",
    authDomain: "af-store-ca33c.firebaseapp.com",
    databaseURL: "https://af-store-ca33c-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "af-store-ca33c",
    storageBucket: "af-store-ca33c.firebasestorage.app",
    messagingSenderId: "980051034376",
    appId: "1:980051034376:web:132c059b120a7a19b7acbd",
    measurementId: "G-SW5R6Y6DLD"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const productList = document.getElementById('productList');
  const cartList = document.getElementById('cartList');
  const totalEl = document.getElementById('total');

  const cart = {};

  // Display products
  db.ref('products').on('value', snapshot => {
    productList.innerHTML = '';
    snapshot.forEach(itemSnap => {
      const item = itemSnap.val();
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <h3>${item.name}</h3>
        <p>Price: ₹${item.price}</p>
        <p>Stock: ${item.stock}</p>
        <button ${item.stock <= 0 ? 'disabled' : ''} onclick="addToCart('${itemSnap.key}')">Add to Cart</button>
      `;
      productList.appendChild(card);
    });
    updateCartDisplay();
  });

  function addToCart(productId) {
    const productRef = db.ref('products/' + productId);
    productRef.transaction(product => {
      if (product && product.stock > 0) {
        product.stock--;
        if (cart[productId]) {
          cart[productId].quantity++;
        } else {
          cart[productId] = { name: product.name, price: product.price, quantity: 1 };
        }
      }
      return product;
    });
    updateCartDisplay();
  }

  function updateCartDisplay() {
    cartList.innerHTML = '';
    let total = 0;
    for (let key in cart) {
      const item = cart[key];
      const li = document.createElement('li');
      li.textContent = `${item.name} x${item.quantity} - ₹${item.price * item.quantity}`;
      cartList.appendChild(li);
      total += item.price * item.quantity;
    }
    totalEl.textContent = 'Total: ₹' + total;
  }
</script>

</body>
</html>