<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AF Stores</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-color: #eaeaea;
  transition: 0.4s;
}

h1 {
  background: #222;
  color: white;
  padding: 15px;
  margin: 0;
}

#categories button {
  padding: 10px 20px;
  margin: 10px;
  font-size: 16px;
  cursor: pointer;
}

#products {
  display: none;
  margin-top: 20px;
  flex-wrap: wrap;
  justify-content: center;
}

.product {
  border: 1px solid #ccc;
  margin: 15px;
  padding: 10px;
  width: 220px;
  background: rgba(255,255,255,0.95);
  border-radius: 8px;
  display: inline-block;
}

.product img {
  width: 100%;
  height: 130px;
  object-fit: cover;
}

#cartButton {
  position: fixed;
  top: 15px;
  right: 15px;
  background: green;
  color: white;
  padding: 10px 15px;
  cursor: pointer;
  border-radius: 5px;
  z-index: 1000;
}

#cart {
  position: fixed;
  right: -320px;
  top: 0;
  width: 300px;
  height: 100%;
  background: #f4f4f4;
  border-left: 2px solid #ccc;
  padding: 10px;
  overflow-y: auto;
  transition: 0.3s;
}

#cart.show {
  right: 0;
}

#cart li button {
  margin-left: 10px;
  background: crimson;
  color: white;
  border: none;
  padding: 3px 6px;
  border-radius: 4px;
  cursor: pointer;
}

.checkout-btn {
  background: green;
  color: white;
  padding: 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>AF Stores</h1>

<div id="cartButton" onclick="toggleCart()">ðŸ›’ Cart</div>

<div id="categories">
  <button onclick="showCategory('vegetable')">Vegetables</button>
  <button onclick="showCategory('stationary')">Stationary</button>
  <button onclick="showCategory('bakery')">Bakery</button>
</div>

<div id="products"></div>

<div id="cart">
  <h2>Your Cart</h2>
  <ul id="cartList"></ul>
  <p id="total">Total: â‚¹0</p>
  <button onclick="checkout()" class="checkout-btn">Checkout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, addDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDUeKvzHtL3wfad44uYZy4BauoBKLl75Xc",
  authDomain: "af-stores.firebaseapp.com",
  projectId: "af-stores",
  storageBucket: "af-stores.firebasestorage.app",
  messagingSenderId: "812053057314",
  appId: "1:812053057314:web:6eac81748c9dae4018df7b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let cart = [];
let currentProducts = [];

// Full product list
const products = [
  // Vegetables
  {"name":"Potato","category":"vegetable","price":20,"stock":50,"image":"https://images.unsplash.com/photo-1582515073490-dc8e2c5b8c42"},
  {"name":"Tomato","category":"vegetable","price":30,"stock":40,"image":"https://images.unsplash.com/photo-1567306226416-28f0efdc88ce"},
  {"name":"Carrot","category":"vegetable","price":25,"stock":35,"image":"https://i.imgur.com/1G5YZ9w.jpg"},
  {"name":"Onion","category":"vegetable","price":45,"stock":70,"image":"https://i.imgur.com/NzXzZfB.jpg"},
  {"name":"Cucumber","category":"vegetable","price":35,"stock":40,"image":"https://i.imgur.com/j1V1n5S.jpg"},
  {"name":"Capsicum","category":"vegetable","price":60,"stock":30,"image":"https://images.unsplash.com/photo-1601041645699-c82e84aa2aeb"},
  {"name":"Spinach","category":"vegetable","price":15,"stock":50,"image":"https://images.unsplash.com/photo-1589308078059-9f2aa4f6f10d"},
  {"name":"Cabbage","category":"vegetable","price":40,"stock":25,"image":"https://images.unsplash.com/photo-1617196031330-47913f604eff"},
  {"name":"Beetroot","category":"vegetable","price":35,"stock":30,"image":"https://images.unsplash.com/photo-1617196029522-86d27a4f2265"},
  {"name":"Ladyfinger","category":"vegetable","price":25,"stock":40,"image":"https://images.unsplash.com/photo-1617196030035-735f4e01c2f1"},

  // Stationary
  {"name":"Pen Pack","category":"stationary","price":50,"stock":100,"image":"https://i.imgur.com/R7VJk1x.jpg"},
  {"name":"Pencil","category":"stationary","price":10,"stock":150,"image":"https://i.imgur.com/mX7G7Hd.jpg"},
  {"name":"Eraser","category":"stationary","price":5,"stock":200,"image":"https://i.imgur.com/2Xv6p0X.jpg"},
  {"name":"Notebook","category":"stationary","price":60,"stock":80,"image":"https://images.unsplash.com/photo-1519681393784-d120267933ba"},
  {"name":"Marker","category":"stationary","price":25,"stock":60,"image":"https://images.unsplash.com/photo-1583484963886-cfe2bff2945f"},
  {"name":"Sketchbook","category":"stationary","price":120,"stock":40,"image":"https://images.unsplash.com/photo-1592194996308-7b43878e84a6"},
  {"name":"Highlighter","category":"stationary","price":15,"stock":90,"image":"https://images.unsplash.com/photo-1592207247997-50c92e2c5410"},
  {"name":"Stapler","category":"stationary","price":100,"stock":30,"image":"https://images.unsplash.com/photo-1586854381501-d50e1241ef92"},
  {"name":"Ruler","category":"stationary","price":10,"stock":100,"image":"https://images.unsplash.com/photo-1592207201512-2b4f43f13eb3"},
  {"name":"Glue Stick","category":"stationary","price":20,"stock":80,"image":"https://images.unsplash.com/photo-1580679333243-99b6c6f5f450"},

  // Bakery
  {"name":"Chocolate Cake","category":"bakery","price":200,"stock":20,"image":"https://i.imgur.com/kL7WzJx.jpg"},
  {"name":"Bread Loaf","category":"bakery","price":40,"stock":35,"image":"https://i.imgur.com/n8D3p8N.jpg"},
  {"name":"Croissant","category":"bakery","price":60,"stock":25,"image":"https://i.imgur.com/qz3F8SJ.jpg"},
  {"name":"Cupcake","category":"bakery","price":30,"stock":50,"image":"https://i.imgur.com/f0z3WmH.jpg"},
  {"name":"Donut","category":"bakery","price":25,"stock":40,"image":"https://images.unsplash.com/photo-1612197508466-1d44da28de5b"},
  {"name":"Muffin","category":"bakery","price":35,"stock":30,"image":"https://images.unsplash.com/photo-1612197528522-8a33b5d7a7f3"},
  {"name":"Baguette","category":"bakery","price":50,"stock":20,"image":"https://images.unsplash.com/photo-1586190848861-99aa4a171e90"},
  {"name":"Donut Glazed","category":"bakery","price":30,"stock":25,"image":"https://images.unsplash.com/photo-1612197547726-b8d96a8f7e3b"},
  {"name":"Brownie","category":"bakery","price":60,"stock":15,"image":"https://images.unsplash.com/photo-1617196031163-bc34c3fa1295"},
  {"name":"Cinnamon Roll","category":"bakery","price":40,"stock":20,"image":"https://images.unsplash.com/photo-1617196031310-bf218f0f2ae7"}
];

// Upload products once (no duplicates)
async function uploadProductsOnce() {
  const existing = await getDocs(collection(db, "products"));
  const existingNames = existing.docs.map(d => d.data().name);

  for (const product of products) {
    if (!existingNames.includes(product.name)) {
      await addDoc(collection(db, "products"), product);
    }
  }
  console.log("Products synced âœ…");
}
uploadProductsOnce();

// Show category
window.showCategory = async function(category){
  const productsDiv = document.getElementById("products");
  productsDiv.innerHTML = "";
  productsDiv.style.display = "block";

  const querySnapshot = await getDocs(collection(db, "products"));
  currentProducts = [];

  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    if(data.category === category){
      currentProducts.push({ id: docSnap.id, ...data });
    }
  });

  currentProducts.forEach((item, index) => {
    productsDiv.innerHTML += `
      <div class="product">
        <img src="${item.image}">
        <h3>${item.name}</h3>
        <p>Price: â‚¹${item.price}</p>
        <p>Stock: ${item.stock}</p>
        <button onclick="addToCart(${index})">Add to Cart</button>
      </div>`;
  });
};

// Add to cart
window.addToCart = async function(index){
  const item = currentProducts[index];
  if(item.stock <= 0){
    alert("Out of Stock");
    return;
  }

  const productRef = doc(db, "products", item.id);
  await updateDoc(productRef, { stock: item.stock - 1 });

  cart.push(item);
  updateCart();
  showCategory(item.category);
};

// Cart update
function updateCart(){
  const cartList = document.getElementById("cartList");
  const total = document.getElementById("total");
  cartList.innerHTML = "";
  let sum = 0;

  cart.forEach(item => {
    sum += item.price;
    cartList.innerHTML += `<li>${item.name} - â‚¹${item.price}</li>`;
  });

  total.innerText = "Total: â‚¹" + sum;
}

window.toggleCart = function(){
  document.getElementById("cart").classList.toggle("show");
};

window.checkout = function(){
  if(cart.length === 0){
    alert("Your cart is empty!");
    return;
  }

  cart = [];
  updateCart();
  window.location.href = "thankyou.html";
};
</script>
</body>
</html>
